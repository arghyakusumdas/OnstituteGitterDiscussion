<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sidecar Basic Example</title>

  <link href="../common.css" rel="stylesheet">
</head>
<body>
  <div class="js-sidecar-status">... waiting for Sidecar</div>
  <button class="js-destroy-chat-button">Destroy Chat</button>
  <button class="js-create-chat-button">Create Chat</button>

  <script>
    ((window.gitter = {}).chat = {}).options = {
      disableDefaultChat: true
    };
  </script>
  <script src="./sidecar.v1.js" async defer></script>

  <script>
    document.addEventListener('gitter-sidecar-ready', function(e) {
      var GitterChat = e.detail.Chat;
      document.querySelector('.js-sidecar-status').innerHTML = 'Click Open chat at bottom right corner';

      var chat;
      document.querySelector('.js-create-chat-button').addEventListener('click', function(e) {
        console.log('Create');
        roomName = 'onstituter/community';
        roomName = getParameterByName('foo'); //// query string: ?foo=lorem&bar=&baz
        console.log(roomName);
        chat = new GitterChat({
          room: roomName
        });
      });

      document.querySelector('.js-destroy-chat-button').addEventListener('click', function(e) {
        console.log('Destroy');
        chat.destroy();
      });
    });

//////////////////////
window.addEventListener('DOMContentLoaded', function(){
        document.querySelector('#my-awesome-el').innerHTML = new Date
        console.log('loaded openchat');
        roomName = 'onstituter/community';
        roomName = getParameterByName('foo'); //// query string: ?foo=lorem&bar=&baz
        console.log(roomName);
        chat = new GitterChat({
          room: roomName
        });
});
//////////////////////

//////////////////////
function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, '\\$&');
    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));
}
//////////////////////
  </script>
</body>
</html>

